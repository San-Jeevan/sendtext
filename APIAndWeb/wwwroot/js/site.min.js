function SendLocationToInternet(position){if(signalrConnected&&"0"!=mySignalRId){var update={SignalRId:mySignalRId,Latitude:position.coords.latitude,Longitude:position.coords.longitude,Type:0},wordsToSend=["testroom",JSON.stringify(update)];contosoChatHubProxy.invoke("sendSessionMessage","testroom",JSON.stringify(eval(update))).done(function(n){console.log(n)})}}function findParticipant(n){for(var o=0;o<_SessionParticipants.length;o++)if(_SessionParticipants[o].SignalRId===n)return _SessionParticipants[o];return null}function StatusUpdate(n){if(n.Status===StatusType.Disconnected){for(var o=0;o<_SessionParticipants.length;o++)if(_SessionParticipants[o].SignalRId===n.SignalRId){var e=_SessionParticipants[o];null!=e&&(e.Marker.Visible=!1,e.Marker.setMap(null)),_SessionParticipants.splice(o,1)}}else n.Status===StatusType.Connected&&SendLocationToInternet({coords:{latitude:_myMarker.position.lat(),longitude:_myMarker.position.lng()}})}function ParticipantLocationReceived(n){if(null!=nMap){var o=JSON.parse(n);if(o.Type===UpdateType.StatusUpdate)return void StatusUpdate(o);var e=new google.maps.LatLng(o.Latitude,o.Longitude),t=findParticipant(o.SignalRId);if(null!=t)t.Marker.Visible=!1,t.Marker.setMap(null),t.Marker=new google.maps.Marker({position:e,map:nMap,title:"Hello World!"});else{_SessionParticipants.push({Marker:new google.maps.Marker({position:e,map:nMap,title:"Hello World!"}),SignalRId:o.SignalRId,Username:"lol"});var i=new google.maps.LatLngBounds;null!=_myMarker&&i.extend(_myMarker.position);for(var a=0;a<_SessionParticipants.length;a++)i.extend(_SessionParticipants[a].Marker.position);nMap.fitBounds(i)}}}function MyLocationReceived(n){if(null!=nMap){var o=new google.maps.LatLng(n.coords.latitude,n.coords.longitude);if(0==_recentCordinates.length){var e=new google.maps.LatLngBounds;e.extend(o);for(var t=0;t<_SessionParticipants.length;t++)e.extend(_SessionParticipants[t].Marker.position);nMap.fitBounds(e)}null!=_myMarker&&(_myMarker.Visible=!1,_myMarker.setMap(null)),_myMarker=new google.maps.Marker({position:o,map:nMap,title:"Hello World!"}),_recentCordinates.push(o),SendLocationToInternet(n)}}StatusType={Connected:0,Disconnected:1},UpdateType={GpsUpdate:0,Message:1,StatusUpdate:2};var _recentCordinates=[],_SessionParticipants=[],_myMarker,signalrConnected=!1,mySignalRId="0",connection=$.hubConnection("http://snuskelabben.cloudapp.net:8022"),contosoChatHubProxy=connection.createHubProxy("gpsHub");contosoChatHubProxy.on("LocationUpdate",function(n){console.log(n),ParticipantLocationReceived(n)}),connection.start().done(function(){console.log("Now connected, connection ID="+connection.id),mySignalRId=connection.id,contosoChatHubProxy.invoke("JoinSession","testroom").done(function(n){signalrConnected=!0,navigator.geolocation?navigator.geolocation.watchPosition(MyLocationReceived):console.log("Geolocation is not supported by this browser.")})}).fail(function(){console.log("Could not connect")});